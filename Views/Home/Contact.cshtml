@model StockControll.ViewModel.UsersViewModel
@using PagedList.Mvc

@{
    ViewBag.Title = "Usuários da aplicação";

    var paginationOpitons = new int[] { 10, 20, 30, 50, 100 };
}

<style>
    .page-title {
        text-align: center;
        margin: 30px 0;
    }

    .weight-600 {
        font-weight: 600;
    }

    .action-buttons {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        width: 100%;
    }

    .filters {
        margin-bottom: 20px;
    }

    .filters-container {
        display: none;
        width: 100%;
        margin-bottom: 10px;
        border: 1px solid black;
    }

    .button-delete {
        background: red !important;
        border-color: red !important;
    }

    .fa-solid {
        margin-right: 8px;
    }

    .modal-title {
        display: contents;
    }

    .pagination-container {
        display: flex;
    }

        .pagination-container > ul {
            margin-inline: auto;
        }
</style>

@Styles.Render("~/Content/bootstrap.min.css", "~/Content/site.css", "~/Content/sweetalert2.min.css")


<h3 class="page-title weight-600">@ViewBag.Title</h3>
<hr class="weight-600" />

<div id="filters" class="filters">
    <div class="filters-container">
        @using (Html.BeginForm("IndexEcsWithBillingLowerThan5k", "Reports", FormMethod.Get))
        {
            <div class="row">
                <div class="col">
                    <input type="text" class="form-control" placeholder="First name" aria-label="First name">
                </div>
                <div class="col">
                    <input type="text" class="form-control" placeholder="Last name" aria-label="Last name">
                </div>
            </div>

            @*<div class="row">



                    <div class="col s6 m3 inline">
                        <label for="txtCnpj">Cnpj</label>
                        <input type="text" id="txtCnpj" name="Cnpj" value="@Model.Filters.SearchItem" class="form-control" />
                    </div>

                    <div class="col s6 m3 inline">
                        <label>Itens por página:</label>
                        <select id="pageSize" onchange="changePageSize()" class="form-control">
                            <option value="" disabled selected>Selecione uma opção</option>
                            <option value="10">10</option>
                            <option value="20">20</option>
                            <option value="50">50</option>
                        </select>
                    </div>
                </div>*@

            @*<div class="row">
                    <div class="col s12 m3">
                        <button type="submit" class="btn btn-primary submit-button">Filtrar</button>
                    </div>
                </div>*@
        }
    </div>
    <div class="row" style="display: flex; gap: 10px;">
        <button id="btnShowFilters"
                class="btn btn-primary">
            filtrar
        </button>
        <button type="button"
                title="O filtro será gerado de acordo com os dados do filtro"
                onclick="downloadExcelFile()"
                class="btn btn-primary">
            Gerar relatório
        </button>

    </div>
</div>

<div class="table-responsive">
    <table class="table">
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Nome</th>
                <th scope="col">Posição</th>
                <th scope="col">Posição</th>
                <th scope="col">Posição</th>
                <th scope="col">Posição</th>
                <th scope="col"></th>
            </tr>
        </thead>
        <tbody class="table-group-divider">
            @foreach (var user in Model.Users)
            {
                <tr>
                    <th scope="row">@user.Id</th>
                    <td>@user.Name</td>
                    <td>@user.UserType</td>
                    <td>@user.UserType</td>
                    <td>@user.UserType</td>
                    <td>@user.UserType</td>
                    <td>
                        <div class="action-buttons">
                            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">
                                <i class="fa-solid fa-pen-to-square"></i>
                                Editar
                            </button>

                            <button type="button" class="btn btn-primary button-delete" onclick="deleteRegister('@user.Id', '@user.Name')">
                                <i class="fa-solid fa-xmark"></i>
                                Deletar
                            </button>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

@if (@Model.Users.TotalItemCount > 0)
{
    <p>Exibindo de @Model.Filters.Page até @Model.Users.PageCount de @Model.Users.TotalItemCount</p>

    @Html.PagedListPager(Model.Users, Page => Url.Action("Contact", new
    {
        Rows = Model.Filters.Rows,
        Page = Page
    }),
    new PagedListRenderOptions
    {
        DisplayLinkToFirstPage = PagedListDisplayMode.Always,
        DisplayLinkToLastPage = PagedListDisplayMode.Always,
        DisplayLinkToPreviousPage = PagedListDisplayMode.Always,
        DisplayLinkToNextPage = PagedListDisplayMode.Always,
        MaximumPageNumbersToDisplay = 3
    })
}

<div class="modal fade" id="myModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="myForm">

                <div class="modal-header">
                    <h3 class="modal-title">Modal Header</h3>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <div class="modal-body">
                    <div class="form-group">
                        <label for="name">Name:</label>
                        <input type="text" class="form-control" id="name" name="name">
                    </div>
                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" class="form-control" id="email" name="email">
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="submitForm()">Submit</button>
                </div>
            </form>

        </div>
    </div>
</div>

@Scripts.Render("~/Content/code.jquery.com_jquery-3.7.1.min.js", "~/Content/sweetalert2.min.js")

<script>
    function submitForm() {
        event.preventDefault();

        console.log('veio aqui', event);

        $("#myForm").submit();
    }

    function deleteRegister(userID, userName) {
        Swal.fire({
            title: 'Uma pergunta ...',
            text: `Deseja deletar o usuário "${userName}"?`,
            icon: 'question',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            cancelButtonText: 'Não',
            confirmButtonText: 'Sim, deletar'
        }).then(result => {
            if (result.isDenied)
                return;

            $.ajax({
                url: "@Url.Action("DeleteUser", "Home")",
                type: "POST",
                data: { userID },
                success: function (data) {
                    if (!data.success) {
                        Swal.fire('Ops ...', data.message, 'error')
                        return;
                    }

                    Swal.fire({
                        title: 'Sucesso!',
                        text: 'Usuário deletado com sucesso.',
                        icon: 'success',
                    })
                },
                error: (err) => Swal.fire('Ops ...', err.message, 'error',
                )
            });
        })
    }

    $(document).ready(function () {

        $("#btnShowFilters").click(function () {
            $(".filters-container").slideToggle();
        });

        $("#myForm").submit(function (event) {
            event.preventDefault();
            // Perform form submission logic here

            $("#myModal").modal("hide");
        });
    });
</script>
